# Interview Job System

## Overview

The Interview Job System implements an asynchronous workflow for interview analysis. Instead of processing interviews synchronously, the system now creates jobs that are processed in the background by the Python AI backend.

## Workflow

### 1. Job Creation
- **Endpoint**: `POST /api/interview/analyze`
- **Request**: Contains `videoUrl`, `userId`, `fileId`, `analysisType`
- **Process**: 
  - Creates an `InterviewJob` entity with status "PENDING"
  - Forwards request to Python AI backend
  - Returns job ID and status immediately
- **Response**: `InterviewJobResponse` with jobId and status

### 2. Background Processing
- Python AI backend processes the video asynchronously
- No blocking of the Java backend during processing

### 3. Callback Processing
- **Endpoint**: `POST /api/interview/analysis-callback`
- **Request**: Contains `jobId`, `analysisData` (JSON), `status`, `errorMessage`
- **Process**: Updates the job with analysis results and status
- **Response**: Confirmation of callback processing

### 4. Job Status Queries
- **Endpoint**: `GET /api/interview/job/{jobId}` - Get basic status
- **Endpoint**: `GET /api/interview/job/{jobId}/detail` - Get detailed info with analysis
- **Endpoint**: `GET /api/interview/jobs` - Get all jobs for current user

## Database Schema

### InterviewJob Entity
```java
- id (Long, Primary Key)
- jobId (String, Unique) - UUID for job tracking
- userId (Long) - User who created the job
- videoUrl (String) - URL of the video to analyze
- status (String) - PENDING, COMPLETED, FAILED
- fileId (Long) - Reference to FileUpload entity
- detailedAnalysis (String) - JSON analysis results
- createdAt (LocalDateTime)
- updatedAt (LocalDateTime)
- analysisType (String) - Type of analysis requested
- errorMessage (String) - Error details if failed
```

## API Endpoints

### Create Analysis Job
```
POST /api/interview/analyze
Content-Type: application/json

{
  "videoUrl": "https://example.com/video.mp4",
  "analysisType": "comprehensive",
  "fileId": 123
}
```

**Note**: The `jobId` is automatically generated by the backend and included when forwarding to the Python AI service.

### Analysis Callback (Called by Python AI)
```
POST /api/interview/analysis-callback
Content-Type: application/json

{
  "jobId": "uuid-here",
  "analysisData": "{\"score\": 85, \"feedback\": \"...\"}",
  "status": "COMPLETED",
  "errorMessage": null
}
```

### Get Job Status
```
GET /api/interview/job/{jobId}
```

### Get Job Details (with analysis)
```
GET /api/interview/job/{jobId}/detail
```

### Get User Jobs
```
GET /api/interview/jobs
```

### Get File Analysis Data
```
GET /api/interview/files/analysis
```

Returns all files for the current user with their most recent analysis job details. For each file:
- If the file has analysis jobs, returns the most recent job details
- If the file has no analysis jobs, returns file info with `analysisStatus: "NO_ANALYSIS"`

**Response Example:**
```json
[
  {
    "fileId": 123,
    "fileName": "interview_video_20231201.mp4",
    "originalFileName": "interview.mp4",
    "fileUrl": "https://example.com/video.mp4",
    "category": "interview",
    "uploadedAt": "2023-12-01T10:30:00",
    "jobId": "uuid-here",
    "analysisStatus": "COMPLETED",
    "analysisType": "comprehensive",
    "detailedAnalysis": "{\"score\": 85, \"feedback\": \"...\"}",
    "errorMessage": null,
    "analysisCreatedAt": "2023-12-01T10:35:00",
    "analysisUpdatedAt": "2023-12-01T10:40:00"
  },
  {
    "fileId": 124,
    "fileName": "resume.pdf",
    "originalFileName": "resume.pdf",
    "fileUrl": "https://example.com/resume.pdf",
    "category": "resume",
    "uploadedAt": "2023-12-01T11:00:00",
    "jobId": null,
    "analysisStatus": "NO_ANALYSIS",
    "analysisType": null,
    "detailedAnalysis": null,
    "errorMessage": null,
    "analysisCreatedAt": null,
    "analysisUpdatedAt": null
  }
]
```

## Status Values

- **PENDING**: Job created, waiting for AI processing
- **COMPLETED**: Analysis completed successfully
- **FAILED**: Analysis failed with error

## Error Handling

- Jobs can be marked as FAILED with error messages
- Callback endpoint handles both success and failure cases
- All endpoints include proper error responses

## Security

- All endpoints require authentication (except callback)
- User can only access their own jobs
- Callback endpoint should be secured with API key in production 